<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard Sukari</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Orbitron', sans-serif;
      background: radial-gradient(ellipse at center, #000000 0%, #001f33 100%);
      color: #00ffe0;
      display: grid;
      grid-template-columns: 1.5fr 2fr 2fr;
      grid-template-rows: auto auto 1fr;
      grid-template-areas:
        "header header header"
        "chrono chrono chrono"
        "stats avatar tables";
      gap: 25px;
      padding: 25px;
      min-height: 100vh;
    }
    h1 {
      grid-area: header;
      text-align: center;
      font-size: 3rem;
      margin: 0 0 15px;
      border-bottom: 1px solid #00ffe0;
      padding-bottom: 10px;
      letter-spacing: 3px;
      text-shadow:
        0 0 5px #00ffe0,
        0 0 20px #00ffe0,
        0 0 30px #00ffe0,
        0 0 40px #00ffe0;
    }
    #chrono {
      grid-area: chrono;
      font-size: 2.4rem;
      font-weight: 700;
      text-align: center;
      padding: 12px 0;
      border: 2px solid #00ffe0;
      border-radius: 12px;
      background: rgba(0, 31, 51, 0.8);
      box-shadow: 0 0 20px #00ffe0, inset 0 0 10px #00ccff;
      animation: pulseGlow 3s infinite alternate;
      margin-bottom: 20px;
    }
    @keyframes pulseGlow {
      from {
        box-shadow: 0 0 20px #00ffe0, inset 0 0 10px #00ccff;
      }
      to {
        box-shadow: 0 0 45px #00ffe0, inset 0 0 25px #00ccff;
      }
    }
    #stats {
      grid-area: stats;
      background: rgba(0, 40, 60, 0.85);
      border: 1.5px solid #00ffe0;
      border-radius: 14px;
      box-shadow: 0 0 15px #00ffe0, inset 0 0 10px #00ccff;
      padding: 20px 25px;
      color: #00ffe0;
      text-align: center;
    }
    #avatar {
      grid-area: avatar;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      margin-top: -40px;
    }
    .hologram-card {
      width: 340px;
      height: 480px;
      padding: 20px;
      position: relative;
      border: 2px solid #00ffe0;
      border-radius: 24px;
      overflow: hidden;
      background: linear-gradient(135deg, #001f33, #000000);
      box-shadow: 0 0 40px #00ffe0, inset 0 0 60px #00ccff;
      animation: flicker 3s infinite;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    @keyframes flicker {
      0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% {
        opacity: 1;
      }
      20%, 22%, 24%, 55% {
        opacity: 0.7;
      }
    }
    .hologram-frame {
      width: 300px;
      height: 420px;
      border: 2px solid #00ffe0;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 0 40px #00ffe0, inset 0 0 30px #00ccff;
      background: linear-gradient(180deg, #001f33 0%, #004466 100%);
    }
    .hologram-avatar {
      width: 100%;
      height: 100%;
      object-fit: cover;
      filter: drop-shadow(0 0 8px #00ffe0);
      opacity: 0.85;
      animation: floatY 3.5s ease-in-out infinite;
    }
    @keyframes floatY {
      0%, 100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-14px);
      }
    }
    #tables {
      grid-area: tables;
      display: flex;
      flex-direction: column;
      gap: 25px;
    }
    #tables h2 {
      color: #00ffe0;
      text-shadow: 0 0 10px #00ffe0;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      margin-bottom: 8px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      color: #00ffe0;
      background: rgba(0, 50, 75, 0.85);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 0 25px #00ccff inset;
    }
    thead th {
      background: rgba(0, 80, 120, 0.9);
      border-bottom: 2px solid #00ffe0;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      padding: 12px;
    }
    tbody td {
      padding: 14px;
      text-align: center;
      border-right: 1px solid #004466;
    }
    tbody td:last-child {
      border-right: none;
    }
    .progress-bar {
      background: #001f33;
      border: 1px solid #00ffe0;
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 10px;
      height: 20px;
    }
    .progress {
      height: 100%;
      background: linear-gradient(90deg, #00ffe0, #00ccff);
      width: 0;
      transition: width 1s ease-in-out;
    }
  </style>
</head>
<body>

  <h1>Dashboard Sukari</h1>

  <div id="chrono">00:00:00</div>

  <section id="stats">
    <h2>Statistiques du joueur</h2>
    <p><strong>Vitesse (UPH) :</strong> <span id="uph">--</span></p>
    <p><strong>Niveau :</strong> <span id="niveau">--</span></p>
    <div class="progress-bar">
      <div class="progress" id="niveau-bar"></div>
    </div>
    <p><strong>Mission du jour :</strong> Atteindre <span style="color: #ff00ff;">-- unités</span></p>
    <p><strong>Total de Sukas :</strong> <span id="sukas">--</span></p>
  </section>

  <section id="avatar">
    <div class="hologram-card">
      <div class="hologram-frame">
        <img src="" alt="Avatar" class="hologram-avatar" id="avatar-img" />
      </div>
    </div>
  </section>

  <section id="tables">
    <div>
      <h2>Transactions</h2>
      <table>
        <thead>
          <tr><th>Date</th><th>Type</th><th>Montant</th></tr>
        </thead>
        <tbody id="transactions-body">
          <!-- données dynamiques ici -->
        </tbody>
      </table>
    </div>
    <div>
      <h2>Missions</h2>
      <table>
        <thead>
          <tr><th>Date</th><th>Mission</th><th>Status</th></tr>
        </thead>
        <tbody id="missions-body">
          <!-- données dynamiques ici -->
        </tbody>
      </table>
    </div>
  </section>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const supabaseUrl = 'https://qytrcfwmsnlpdsdybcwo.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF5dHJjZndtc25scGRzZHliY3dvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3NjE5ODIsImV4cCI6MjA2NzMzNzk4Mn0.VGLI9SmCg6bNDUAVu3tgZjoejtiQRlAk6ufClWD_4SM';
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    // Récupérer l'ID utilisateur depuis l'URL
    function getUserId() {
      const params = new URLSearchParams(window.location.search);
      return params.get('id');
    }

    // Mettre à jour l'horloge
    function updateChrono() {
      const now = new Date();
      const chrono = document.getElementById('chrono');
      const h = String(now.getHours()).padStart(2, '0');
      const m = String(now.getMinutes()).padStart(2, '0');
      const s = String(now.getSeconds()).padStart(2, '0');
      chrono.textContent = `${h}:${m}:${s}`;
    }
    setInterval(updateChrono, 1000);
    updateChrono();

    // Charger et afficher les données du joueur
    async function loadUserData() {
      const userId = getUserId();
      if (!userId) {
        alert('Aucun utilisateur détecté. Veuillez vous reconnecter.');
        window.location.href = 'login.html'; // ou ta page login
        return;
      }

      // Récupérer données de base depuis Supabase
      const { data: userData, error: userError } = await supabase
        .from('mot_de_passe') // adapte selon ta table
        .select('*')
        .eq('ID', userId);

      if (userError || !userData || userData.length === 0) {
        alert('Utilisateur introuvable ou erreur serveur.');
        return;
      }
      const user = userData[0];

      // Affichage des stats
      document.getElementById('uph').textContent = user.UPH || '--';
      document.getElementById('niveau').textContent = user.Niveau || '--';
      document.getElementById('sukas').textContent = user.Sukas || '--';
      document.querySelector('#stats p strong + span').textContent = user.Mission || 'Atteindre 1850 unités';

      // Barre de progression du niveau
      const niveauBar = document.getElementById('niveau-bar');
      const niveauPercent = (user.Niveau / 5) * 100; // supposons max niveau 5
      niveauBar.style.width = niveauPercent + '%';

      // Avatar
      const avatarImg = document.getElementById('avatar-img');
      avatarImg.src = user.AvatarUrl || 'https://drive.google.com/uc?export=view&id=1giGXL-uR-Hs8CrQmuONqQHxFL4F64TQA';
      avatarImg.alt = user.ID + ' avatar';

      // Récupérer et afficher Transactions (table 'transactions')
      const { data: transactions, error: txError } = await supabase
        .from('transactions')
        .select('*')
        .eq('ID', userId)
        .order('Date', { ascending: false });

      const txBody = document.getElementById('transactions-body');
      if (txError || !transactions) {
        txBody.innerHTML = '<tr><td colspan="3">Aucune transaction disponible</td></tr>';
      } else {
        txBody.innerHTML = transactions.length === 0
          ? '<tr><td colspan="3">Aucune transaction trouvée</td></tr>'
          : transactions.map(tx => `<tr>
              <td>${tx.Date}</td>
              <td>${tx.Type}</td>
              <td>${tx.Montant}</td>
            </tr>`).join('');
      }

      // Récupérer et afficher Missions (table 'missions')
      const { data: missions, error: missionsError } = await supabase
        .from('missions')
        .select('*')
        .eq('ID', userId)
        .order('Date', { ascending: false });

      const missionsBody = document.getElementById('missions-body');
      if (missionsError || !missions) {
        missionsBody.innerHTML = '<tr><td colspan="3">Aucune mission disponible</td></tr>';
      } else {
        missionsBody.innerHTML = missions.length === 0
          ? '<tr><td colspan="3">Aucune mission trouvée</td></tr>'
          : missions.map(m => `<tr>
              <td>${m.Date}</td>
              <td>${m.Mission}</td>
              <td>${m.Status}</td>
            </tr>`).join('');
      }
    }

    // Initialiser le dashboard à l'ouverture
    window.onload = loadUserData;
  </script>
</body>
</html>
